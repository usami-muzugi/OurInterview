# 加载限制

类加载器需要特别考虑到类型的安全链接问题。一种可能出现的情况是，当两个不同的类加载器初始加载标记为 N 的类或接口时，在每个加载器里 N 表示着不同的类或接口。
当类或接口 C=<N1， L1>包含另外一个类或接口 D=<N2， L2>的字段或方法的符号引用时，这个符号引用会包含字段的特定描述符，或方法的参数和返回值类型。很重要的一点是，不管是L1 还是 L2 加载，任何字段或方法描述符类型 N 都应该表示相同的类或接口。
为了确保这个原则， Java 虚拟机在准备（ §5.4.2）和解析（ §5.4.3）阶段强制“N L1 = N L 2 ”形式的加载约束（ Loading Constraints）。为了强制实施这个约束， Java 虚拟机会在类型加载的某些关键点（ §5.3.1、 §5.3.2、 §5.3.3、 §5.3.4、 §5.3.5）记录下每个特定类的初始加载器。在记录一个加载器是某个类的初始加载器后， Java 虚拟机会立即检查是否有加载过程违反了这一约束。如果有违约情况发生，此次记录过程将被撤销， Java 虚拟机抛出LinkageError，引起记录产生的那次加载操作也同样会失败。
与之相似的是，在强制执行了加载约束（参见§5.4.2、 §5.4.3.2、 §5.4.3.3、§5.4.3.4）之后，虚拟机必须立即去检查是否有违约情况发生。如果有，最新的那个加载约束就会被撤销， Java 虚拟机抛出 LinkageError 异常，引入约束（解析或准备，视情况而定）的那些操作也会失败。
下列步骤描述 Java 虚拟机检查加载约束被违约的发生的条件。加载约束被违反，当且仅当下面的四个条件同时符合：

* 类加载器 L 被 Java 虚拟机记录为标记为 N 的类 C 的初始加载器。
* 类加载器 L’被 Java 虚拟机记录为标记为 N 的类 C’的初始加载器。
* 强加的限制定义了等价关系 N L = N L '
* C ≠ C’

对于类加载器和类型安全的进一步讨论已经超出了我们这篇规范的范畴。如果读者想了解更多的细节，请参阅由 Sheng Liang 和 Gilad Bracha 所著的《 Dynamic Class Loading in the Java Virtual Machine》（ 1998 年 ACM SIGPLAN 关于面向对象编程系统、语言及应用的会议记要）。 