# 类型推断的验证过程 

在链接过程中，验证器通过数据流分析的方式检查每个方法 Code 属性中的 code[]数组。验证器必须确保程序中无论在任何执行时间、无论是选择哪条执行路径，都必须遵循以下规则：

* 操作数栈的深度及所包含的值的类型总是相同。
* 在明确确定要局部变量的数据类型之前， 不能访问该局部变量。
* 方法调用必须携带适当的参数。
* 对字段所赋的值一定会与对象的类型相符。
* 所有的操作码在操作数栈和局部变量表中都有适当类型的参数。
* 对于由异常处理器所保护的代码， 局部变量中不允许出现未初始化的类实例。然而，未初始化的类实例可以出现在由异常处理器保护的代码的操作数栈中， 因为当异常被抛出时，操作数栈的内容就会被丢弃。

更多数据流分析的细节，请参考 4.10.2.2 节“字节码验证器”。
有时候考虑到效率，验证器中一些关键测试会被延迟至方法的代码第一次被真正调用时才执行。正因如此，验证器除非确实有必要的情况， 否则都会尽量避免触发其他 Class 文件的加载。
例如， 某个方法调用另一个方法， 且被调用的方法返回了一个类 A 的实例，这个实例会赋值给与它相同类型的一个字段，这时验证器不会耗费时间去检查 A 类是否真实存在。然而，如果这个实例被赋值给 B 类型的字段，那么验证器必须确保 A 和 B 类都已经加载过且 A 是 B 的某个子类。 





