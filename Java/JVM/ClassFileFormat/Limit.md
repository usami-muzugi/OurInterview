# JVM 限制

下面为隐含在 Class 文件格式中的 Java 虚拟机限制：

1. 每个类或接口的常量池项最多为 65535 个，它是由 ClassFile 结构（ §4.1）中的 16位 constant_pool_count 字段的值决定。这限制了单个类或接口的复杂度。
2. 方法调用时创建的栈帧的局部变量表中的最大局部变量个数 65535 个，它是由方法代码所处的 Code 属性（ §4.7.3）中的 max_locals 项的值和 Java 虚拟机指令集的 16位局部变量索引所决定。注意，每个 long 和 double 类型都被认为会使用两个局部变量位置并占据 max_locals 中的两个单元，所以使用这些类型时，局部变量的限制的最大值就会相应地减少。
3. 类或接口中可以声明的字段数最多为 65535 个，它是由 ClassFile 结构（ §4.1）中fields_count 项的值所决定。注意， ClassFile 结构中的 fields_count 项的值不包含从父类或父接口中继承下来的字段。
4. 类或接口中可以声明的方法数最多为 65535 个，它是由 ClassFile 结构（ §4.1）中的 methods_count 项的值所决定。注意， ClassFile 结构中的 methods_count 项的值不包含从父类或父接口中继承下来的方法。
5. 类或接口的直接父接口最多为 65535 个，它是由 ClassFile 结构（ §4.1）中的interfaces_count 项的值所决定。
6. 方法栈帧（ §2.6）中的操作数栈的大小深度为 65535， 它是由 Code 属性（ §4.7.3）的 max_stack 字段值来决定。需要注意的是每个 long 和 double 类型的数据被认为占用 max_locals 中的两个单元，所以使用这些类型时，操作数栈的限制的最大值就会相应地减少。 


7. 数组的维度最大为 255 维，这由 multianewarray 指令的 dimensions 操作码及§4.9.1 和§4.9.2 节 multianewarray， anewarray 和 newarray 指令的约束来决定。
8. 方法的参数最多有 255 个，它是由方法描述符（ §4.3.3）的定义所限制，如果方法调用是针对实例或接口方法，那么这个限制也包含着占有一个单元的 this。注意对于定义在方法描述符中的参数长度来说，每个 long 和 double 参数都会占用两个长度单位，所以如果有这些类型的话，最终的限制的最大值将会变小。
9. 字段和方法名称、字段和方法描述符以及其它常量字符串值（由 ConstantValue 属性（ §4.7.2）引用的值）最大长度为 65535 个字符，它是由 CONSTANT_Utf8_info 结构（ §4.4.7）的 16 位无符号 length 项决定。需要注意的是，这里的限制是已编码字符串的字节数量而不是被编码的字符数量。 UTF-8 一般用两个或三个字节来编码字符，因此，当字符串中包含多字节字符时，会受到更大的约束。 

